<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥">
    <meta name="theme-color" content="#0a0e1a">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ | El Jasus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="ElJasus2.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { 
            --bg-color: #0a0e1a;
            --card-color: rgba(15, 20, 35, 0.95);
            --primary-color: #00f2ff;
            --secondary-color: #7c30ff;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1535 50%, #0f0c1d 100%);
            background-attachment: fixed;
            color: #ffffff; 
            min-height: 100vh; 
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background Grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }

        /* Floating Particles */
        body::after {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(2px 2px at 20% 30%, rgba(124, 48, 255, 0.3), transparent),
                              radial-gradient(2px 2px at 60% 70%, rgba(0, 242, 255, 0.3), transparent),
                              radial-gradient(1px 1px at 50% 50%, rgba(255, 255, 255, 0.2), transparent);
            background-size: 200% 200%;
            animation: particleFloat 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes particleFloat {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 0.6; transform: translateY(-20px); }
        }
        
        /* Glass Morphism */
        .glass { 
            background: linear-gradient(135deg, rgba(15, 20, 35, 0.9), rgba(25, 30, 50, 0.8));
            backdrop-filter: blur(20px);
            border: 2px solid;
            border-image: linear-gradient(135deg, rgba(0, 242, 255, 0.3), rgba(124, 48, 255, 0.3)) 1;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 30px rgba(0, 242, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .glass::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(0, 242, 255, 0.05),
                transparent
            );
            animation: shimmer 3s infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .neon-text {
            font-family: 'Orbitron', sans-serif;
            text-shadow: 
                0 0 10px rgba(0, 242, 255, 0.8),
                0 0 20px rgba(0, 242, 255, 0.6),
                0 0 30px rgba(0, 242, 255, 0.4);
        }

        /* Leaderboard Tab Styles */
        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: inherit;
            z-index: -1;
        }

        .tab-btn:not(.active):hover::before {
            opacity: 0.2;
        }

        /* Medal Styles */
        .medal-gold {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            animation: goldPulse 2s infinite;
        }

        .medal-silver {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            box-shadow: 0 0 20px rgba(192, 192, 192, 0.4);
        }

        .medal-bronze {
            background: linear-gradient(135deg, #cd7f32, #e09856);
            box-shadow: 0 0 20px rgba(205, 127, 50, 0.4);
        }

        @keyframes goldPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }

        /* Rank Styles */
        .rank-1 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border-color: rgba(255, 215, 0, 0.5) !important;
        }

        .rank-2 {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.1));
            border-color: rgba(192, 192, 192, 0.5) !important;
        }

        .rank-3 {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.1));
            border-color: rgba(205, 127, 50, 0.5) !important;
        }

        /* Trophy Animation */
        .trophy-icon {
            animation: trophyFloat 3s ease-in-out infinite;
        }

        @keyframes trophyFloat {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { 
            background: rgba(0, 242, 255, 0.05);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        /* Stat Card */
        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                60deg,
                transparent,
                rgba(0, 242, 255, 0.1),
                transparent
            );
            animation: statShine 3s infinite;
        }

        @keyframes statShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Badge Styles */
        .badge-spy {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }

        .badge-innocent {
            background: linear-gradient(135deg, #059669, #047857);
            box-shadow: 0 0 15px rgba(5, 150, 105, 0.5);
        }
    </style>
</head>
<body class="p-4 pb-10">

    <!-- Header -->
    <header class="max-w-6xl mx-auto mb-6 relative z-10">
        <div class="flex items-center justify-between">
            <!-- Back Button -->
            <a href="index.html" class="flex items-center gap-2 text-gray-400 hover:text-cyan-400 transition-all hover:translate-x-1">
                <i class="fas fa-arrow-right text-xl"></i>
                <span class="text-sm font-bold">ÿ±ÿ¨Ÿàÿπ</span>
            </a>
            
            <!-- Title -->
            <div class="text-center flex-1">
                <div class="flex items-center justify-center gap-3 mb-2">
                    <i class="fas fa-trophy text-4xl text-yellow-500 trophy-icon"></i>
                </div>
                <h1 class="text-3xl font-black uppercase tracking-tight neon-text">
                    ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
                </h1>
                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider mt-1" style="font-family: 'Orbitron', sans-serif;">HALL OF FAME</p>
            </div>

            <!-- Refresh Button -->
            <button id="refreshBtn" class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-2 border-cyan-500/30 flex items-center justify-center hover:scale-110 transition-all group">
                <i class="fas fa-sync-alt text-cyan-400 group-hover:rotate-180 transition-transform duration-500"></i>
            </button>
        </div>
    </header>

    <div class="max-w-6xl mx-auto relative z-10">
        
        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 animate__animated animate__fadeIn">
            
            <!-- Total Players -->
            <div class="glass rounded-2xl p-5 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-[10px] font-bold opacity-50 uppercase tracking-wider mb-1" style="font-family: 'Orbitron', sans-serif;">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ</p>
                        <h3 id="totalPlayers" class="text-3xl font-black text-cyan-400" style="font-family: 'Orbitron', sans-serif;">0</h3>
                    </div>
                    <div class="w-16 h-16 rounded-full bg-cyan-500/20 border-2 border-cyan-500/30 flex items-center justify-center">
                        <i class="fas fa-users text-2xl text-cyan-400"></i>
                    </div>
                </div>
            </div>

            <!-- Total Games -->
            <div class="glass rounded-2xl p-5 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-[10px] font-bold opacity-50 uppercase tracking-wider mb-1" style="font-family: 'Orbitron', sans-serif;">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™</p>
                        <h3 id="totalGames" class="text-3xl font-black text-purple-400" style="font-family: 'Orbitron', sans-serif;">0</h3>
                    </div>
                    <div class="w-16 h-16 rounded-full bg-purple-500/20 border-2 border-purple-500/30 flex items-center justify-center">
                        <i class="fas fa-gamepad text-2xl text-purple-400"></i>
                    </div>
                </div>
            </div>

            <!-- Best Spy -->
            <div class="glass rounded-2xl p-5 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-[10px] font-bold opacity-50 uppercase tracking-wider mb-1" style="font-family: 'Orbitron', sans-serif;">ÿ£ŸÅÿ∂ŸÑ ÿ¨ÿßÿ≥Ÿàÿ≥</p>
                        <h3 id="bestSpy" class="text-lg font-black text-red-400 truncate max-w-[150px]">---</h3>
                    </div>
                    <div class="w-16 h-16 rounded-full bg-red-500/20 border-2 border-red-500/30 flex items-center justify-center">
                        <i class="fas fa-user-secret text-2xl text-red-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="glass rounded-2xl p-2 mb-6 animate__animated animate__fadeIn">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <button onclick="switchTab('spy')" id="tab-spy" class="tab-btn active px-4 py-3 rounded-xl font-black text-sm uppercase tracking-wider transition-all">
                    <i class="fas fa-user-secret ml-2"></i>
                    ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ¨Ÿàÿßÿ≥Ÿäÿ≥
                </button>
                <button onclick="switchTab('innocent')" id="tab-innocent" class="tab-btn px-4 py-3 rounded-xl font-black text-sm uppercase tracking-wider transition-all">
                    <i class="fas fa-shield-alt ml-2"></i>
                    ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿ®ÿ±Ÿäÿßÿ°
                </button>
                <button onclick="switchTab('total')" id="tab-total" class="tab-btn px-4 py-3 rounded-xl font-black text-sm uppercase tracking-wider transition-all">
                    <i class="fas fa-trophy ml-2"></i>
                    ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä
                </button>
                <button onclick="switchTab('rank')" id="tab-rank" class="tab-btn px-4 py-3 rounded-xl font-black text-sm uppercase tracking-wider transition-all">
                    <i class="fas fa-crown ml-2"></i>
                    ÿßŸÑÿ±ÿ™ÿ®
                </button>
            </div>
        </div>

        <!-- Leaderboard Content -->
        <div class="animate__animated animate__fadeIn">
            
            <!-- Spy Wins Leaderboard -->
            <div id="leaderboard-spy" class="leaderboard-content">
                <div class="glass rounded-2xl p-6 mb-4">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-black uppercase tracking-tight flex items-center gap-2">
                            <span class="w-10 h-10 rounded-lg bg-red-500/20 border-2 border-red-500/30 flex items-center justify-center">
                                <i class="fas fa-user-secret text-red-400"></i>
                            </span>
                            <span class="neon-text">ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ¨Ÿàÿßÿ≥Ÿäÿ≥</span>
                        </h2>
                        <span class="badge-spy px-4 py-2 rounded-full text-xs font-black uppercase" style="font-family: 'Orbitron', sans-serif;">
                            SPY WINS
                        </span>
                    </div>
                    
                    <div id="spyLeaderboardList" class="space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar">
                        <!-- Loading skeleton -->
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                    </div>
                </div>
            </div>

            <!-- Innocent Wins Leaderboard -->
            <div id="leaderboard-innocent" class="leaderboard-content hidden">
                <div class="glass rounded-2xl p-6 mb-4">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-black uppercase tracking-tight flex items-center gap-2">
                            <span class="w-10 h-10 rounded-lg bg-green-500/20 border-2 border-green-500/30 flex items-center justify-center">
                                <i class="fas fa-shield-alt text-green-400"></i>
                            </span>
                            <span class="neon-text">ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿ®ÿ±Ÿäÿßÿ°</span>
                        </h2>
                        <span class="badge-innocent px-4 py-2 rounded-full text-xs font-black uppercase" style="font-family: 'Orbitron', sans-serif;">
                            INNOCENT WINS
                        </span>
                    </div>
                    
                    <div id="innocentLeaderboardList" class="space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar">
                        <!-- Loading skeleton -->
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                    </div>
                </div>
            </div>

            <!-- Total Games Leaderboard -->
            <div id="leaderboard-total" class="leaderboard-content hidden">
                <div class="glass rounded-2xl p-6 mb-4">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-black uppercase tracking-tight flex items-center gap-2">
                            <span class="w-10 h-10 rounded-lg bg-yellow-500/20 border-2 border-yellow-500/30 flex items-center justify-center">
                                <i class="fas fa-trophy text-yellow-400"></i>
                            </span>
                            <span class="neon-text">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™</span>
                        </h2>
                        <span class="px-4 py-2 rounded-full text-xs font-black uppercase bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border-2 border-yellow-500/30" style="font-family: 'Orbitron', sans-serif;">
                            TOTAL GAMES
                        </span>
                    </div>
                    
                    <div id="totalLeaderboardList" class="space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar">
                        <!-- Loading skeleton -->
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                        <div class="skeleton rounded-xl h-20"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        
const firebaseConfig = {
  apiKey: "AIzaSyDnd-pmKEatI3DaFz6xHWB5ucurtHXt9tk",
  authDomain: "el-jasus.firebaseapp.com",
  databaseURL: "https://el-jasus-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "el-jasus",
  storageBucket: "el-jasus.firebasestorage.app",
  messagingSenderId: "415659587906",
  appId: "1:415659587906:web:782f7940176ea4097eb0db",
  measurementId: "G-N4K79FP56N"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window._firebaseFns = { ref, get, update, onValue, push, serverTimestamp };

        let allPlayers = [];

        // Tab Switching
        window.switchTab = (tab) => {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');

            // Update content
            document.querySelectorAll('.leaderboard-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(`leaderboard-${tab}`).classList.remove('hidden');
        };

        // Fetch Leaderboard Data
        async function fetchLeaderboard() {
            const playersRef = ref(db, 'players');
            
            onValue(playersRef, (snapshot) => {
                const data = snapshot.val();
                allPlayers = [];
                
                if (data) {
                    Object.keys(data).forEach(uid => {
                        const player = data[uid];
                        allPlayers.push({
                            uid: uid,
                            username: player.username || 'ŸÖÿ¨ŸáŸàŸÑ',
                            email: player.email || '',
                            spyWins: player.stats?.spyWins || 0,
                            innocentWins: player.stats?.innocentWins || 0,
                            totalGames: player.stats?.totalGames || 0,
                            winRate: calculateWinRate(player.stats)
                        });
                    });
                }

                updateStats();
                renderLeaderboards();
            });
        }

        function calculateWinRate(stats) {
            if (!stats || stats.totalGames === 0) return 0;
            const totalWins = (stats.spyWins || 0) + (stats.innocentWins || 0);
            return ((totalWins / stats.totalGames) * 100).toFixed(1);
        }

        // Update Stats Overview
        function updateStats() {
            document.getElementById('totalPlayers').innerText = allPlayers.length;
            
            const totalGamesPlayed = allPlayers.reduce((sum, p) => sum + p.totalGames, 0);
            document.getElementById('totalGames').innerText = totalGamesPlayed;

            const topSpy = allPlayers.sort((a, b) => b.spyWins - a.spyWins)[0];
            document.getElementById('bestSpy').innerText = topSpy ? topSpy.username : '---';
        }

        // Render Leaderboards
        function renderLeaderboards() {
            // Spy Wins Leaderboard
            const spyRanked = [...allPlayers].sort((a, b) => b.spyWins - a.spyWins).slice(0, 50);
            renderLeaderboardList('spyLeaderboardList', spyRanked, 'spyWins', 'spy');

            // Innocent Wins Leaderboard
            const innocentRanked = [...allPlayers].sort((a, b) => b.innocentWins - a.innocentWins).slice(0, 50);
            renderLeaderboardList('innocentLeaderboardList', innocentRanked, 'innocentWins', 'innocent');

            // Total Games Leaderboard
            const totalRanked = [...allPlayers].sort((a, b) => b.totalGames - a.totalGames).slice(0, 50);
            renderLeaderboardList('totalLeaderboardList', totalRanked, 'totalGames', 'total');
        }

        function renderLeaderboardList(containerId, players, statKey, type) {
            const container = document.getElementById(containerId);
            
            if (players.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16 empty-state">
                        <i class="fas fa-inbox text-6xl text-gray-700 mb-4"></i>
                        <h3 class="text-xl font-black text-gray-400 mb-2">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™</h3>
                        <p class="text-sm text-gray-600">ŸÑŸÖ ŸäŸÑÿπÿ® ÿ£ÿ≠ÿØ ÿ®ÿπÿØ!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = players.map((player, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : '';
                const medalClass = rank === 1 ? 'medal-gold' : rank === 2 ? 'medal-silver' : rank === 3 ? 'medal-bronze' : '';
                
                let icon = '';
                let statColor = '';
                
                if (type === 'spy') {
                    icon = '<i class="fas fa-user-secret text-red-400"></i>';
                    statColor = 'text-red-400';
                } else if (type === 'innocent') {
                    icon = '<i class="fas fa-shield-alt text-green-400"></i>';
                    statColor = 'text-green-400';
                } else {
                    icon = '<i class="fas fa-gamepad text-purple-400"></i>';
                    statColor = 'text-purple-400';
                }

                return `
                    <div class="glass rounded-xl p-4 border-2 ${rankClass} hover:border-cyan-500/50 transition-all group">
                        <div class="flex items-center justify-between gap-4">
                            
                            <!-- Rank -->
                            <div class="flex-shrink-0">
                                ${rank <= 3 ? `
                                    <div class="w-12 h-12 ${medalClass} rounded-full flex items-center justify-center text-black font-black text-xl border-2 border-white/20" style="font-family: 'Orbitron', sans-serif;">
                                        ${rank}
                                    </div>
                                ` : `
                                    <div class="w-12 h-12 bg-white/5 border-2 border-white/10 rounded-full flex items-center justify-center text-gray-400 font-black text-lg" style="font-family: 'Orbitron', sans-serif;">
                                        ${rank}
                                    </div>
                                `}
                            </div>

                            <!-- Player Info -->
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-black text-white truncate mb-1 group-hover:text-cyan-400 transition-colors">
                                    ${player.username}
                                </h3>
                                <div class="flex items-center gap-3 text-xs">
                                    <span class="text-gray-400 font-bold">
                                        ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤: <span class="text-cyan-400">${player.winRate}%</span>
                                    </span>
                                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                                    <span class="text-gray-400 font-bold">
                                        ŸÖÿ®ÿßÿ±Ÿäÿßÿ™: <span class="text-purple-400">${player.totalGames}</span>
                                    </span>
                                </div>
                            </div>

                            <!-- Stat -->
                            <div class="flex-shrink-0 text-right">
                                <div class="flex items-center gap-2 mb-1">
                                    ${icon}
                                    <span class="text-2xl font-black ${statColor}" style="font-family: 'Orbitron', sans-serif;">
                                        ${player[statKey]}
                                    </span>
                                </div>
                                <p class="text-[9px] text-gray-500 font-bold uppercase tracking-wider">
                                    ${type === 'spy' ? 'SPY WINS' : type === 'innocent' ? 'INNOCENT WINS' : 'TOTAL GAMES'}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Refresh Button
        document.getElementById('refreshBtn').addEventListener('click', () => {
            const btn = document.getElementById('refreshBtn');
            btn.querySelector('i').classList.add('fa-spin');
            
            fetchLeaderboard();
            
            setTimeout(() => {
                btn.querySelector('i').classList.remove('fa-spin');
            }, 1000);
        });

        // Initialize
        fetchLeaderboard();

        // RANK LEADERBOARD
        const RANK_ORDER  = {Diamond:5,Platinum:4,Gold:3,Silver:2,Bronze:1};
        const RANK_COLORS = {Diamond:'#00f2ff',Platinum:'#e5e4e2',Gold:'#ffd700',Silver:'#c0c0c0',Bronze:'#cd7f32'};
        const RANK_ICONS  = {Diamond:'\u{1F4E0}',Platinum:'\u{1F48E}',Gold:'\u{1F947}',Silver:'\u{1F948}',Bronze:'\u{1F949}'};

        function loadRankLeaderboard() {
            const listEl = document.getElementById('rank-leaderboard-list');
            const tierEl = document.getElementById('rank-tier-counts');
            const counts = {Bronze:0,Silver:0,Gold:0,Platinum:0,Diamond:0};
            const now = new Date();
            document.getElementById('season-name').textContent =
                'ŸÖŸàÿ≥ŸÖ ' + now.toLocaleDateString('ar-SA',{month:'long',year:'numeric'});
            document.getElementById('season-dates').textContent =
                'ŸäŸÜÿ™ŸáŸä: ' + new Date(now.getFullYear(),now.getMonth()+1,0).toLocaleDateString('ar-SA');

            get(ref(db,'players')).then(snap => {
                if (!snap.exists()) { listEl.innerHTML='<p class="text-gray-400 text-center">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÑÿßÿπÿ®ŸàŸÜ</p>'; return; }
                const all = Object.values(snap.val()).filter(p=>p.username).map(p=>({
                    username:p.username, rank:p.rank||'Bronze',
                    rankPoints:p.rankPoints||0, totalGames:p.stats&&p.stats.totalGames||0
                })).sort((a,b)=>(RANK_ORDER[b.rank]||0)-(RANK_ORDER[a.rank]||0)||b.rankPoints-a.rankPoints);

                all.forEach(p=>{if(counts[p.rank]!==undefined)counts[p.rank]++;});
                tierEl.innerHTML = Object.entries(counts).map(([tier,cnt])=>{
                    const c=RANK_COLORS[tier]||'#888';
                    return '<div class="text-center p-2 rounded-xl" style="background:'+c+'22;border:2px solid '+c+'44;">'
                        +'<p class="text-sm font-black" style="color:'+c+';">'+tier+'</p>'
                        +'<p class="text-lg font-black" style="color:'+c+';">'+cnt+'</p></div>';
                }).join('');

                listEl.innerHTML = all.slice(0,50).map((p,i)=>{
                    const c=RANK_COLORS[p.rank]||'#888';
                    const progress=Math.min(100,(p.rankPoints%1000)/10);
                    const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'#'+(i+1);
                    return '<div class="flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-all" style="border:1px solid rgba(255,255,255,.05);">'
                        +'<span class="text-lg w-8 text-center font-bold">'+medal+'</span>'
                        +'<div class="flex-1 min-w-0">'
                        +'<p class="font-black truncate">'+p.username+'</p>'
                        +'<div style="height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin-top:4px;overflow:hidden;">'
                        +'<div style="width:'+progress+'%;height:100%;background:'+c+';border-radius:2px;"></div></div></div>'
                        +'<div class="text-right flex-shrink-0">'
                        +'<p class="font-black text-sm" style="color:'+c+';">'+p.rank+'</p>'
                        +'<p class="text-xs text-gray-500">'+p.rankPoints+' pts</p></div></div>';
                }).join('');
            });
        }

        const _origSwitch = window.switchTab;
        window.switchTab = (tab) => { _origSwitch(tab); if(tab==='rank') loadRankLeaderboard(); };

    </script>

        <!-- Rank Leaderboard -->
        <div id="leaderboard-rank" class="leaderboard-content hidden">
            <div class="glass rounded-2xl p-6">
                <h2 class="text-xl font-black mb-2 flex items-center gap-2">
                    <span class="w-10 h-10 rounded-lg bg-yellow-500/20 border-2 border-yellow-500/30 flex items-center justify-center"><i class="fas fa-crown text-yellow-400"></i></span>
                    ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ±ÿ™ÿ®
                </h2>
                <p id="season-name" class="text-cyan-400 text-sm font-bold mb-1"></p>
                <p id="season-dates" class="text-gray-500 text-xs mb-4"></p>
                <div class="grid grid-cols-5 gap-2 mb-5" id="rank-tier-counts"></div>
                <div id="rank-leaderboard-list" class="space-y-2">
                    <p class="text-gray-400 text-center py-4">ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ±ÿ™ÿ® ŸÑÿ™ÿ≠ŸÖŸäŸÑŸáÿß</p>
                </div>
            </div>
        </div>
    <link rel="stylesheet" href="mobile.css">
    <script src="sound-system.js" defer></script>
    <script src="qr-notifications.js" defer></script>
    <script src="dialogs.js"></script>
<script>
    window.alert   = (msg)             => UIAlert(msg);
    window.confirm = (msg)             => UIConfirm(msg);
    window.prompt  = (msg, defaultVal) => UIPrompt(msg, { defaultValue: defaultVal });
</script>
    <script>if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));}</script>
    <script src="moderation.js"></script>
</body>
</html>
